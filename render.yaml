services:
  - type: web
    name: fastapi-trading-bot
    env: python
    plan: starter                    # ★ 유료(Always On)
    region: oregon
    buildCommand: pip install -r requirements.txt
    startCommand: >
      gunicorn main:app
      -k uvicorn.workers.UvicornWorker
      --workers 2
      --bind 0.0.0.0:10000
      --timeout 60
      --keep-alive 75
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: TRACE_LOG
        value: "1"
      # ===== Bitget v2 우선 사용 플래그 =====
      - key: BITGET_USE_V2
        value: "1"
      # (필요 시 바꿔 쓸 수 있게 경로도 변수로 노출. 값이 비면 v1로 폴백됨)
      - key: BITGET_V2_TICKER_PATH
        value: "/api/v2/mix/market/ticker"
      - key: BITGET_V2_MARK_PATH
        value: "/api/v2/mix/market/mark-price"
      - key: BITGET_V2_DEPTH_PATH
        value: "/api/v2/mix/market/orderbook"
      # ===== 기존에 쓰던 환경변수들(예시) =====
      - key: LEVERAGE
        value: "5"
      - key: STOP_PCT
        value: "0.10"
      - key: BE_ENABLE
        value: "1"
      - key: BE_AFTER_STAGE
        value: "1"
      - key: TRADE_LOG_DIR
        value: "./logs"
